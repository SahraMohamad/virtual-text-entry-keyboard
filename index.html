<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swipe-to-Text Virtual Keyboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
</head>
<body>
    <div class="container">
        <h1>Swipe-to-Text Virtual Keyboard</h1>
        <div class="toolbar">
            <div class="toolbar-left">
                <button id="help-button" class="help-btn" title="How it works">‚ùì Tips</button>
            </div>
            <button id="settings-button" class="settings-btn" aria-expanded="false" aria-controls="settings-panel" title="Open settings">‚öôÔ∏è Settings</button>
        </div>
        <div class="settings-panel" id="settings-panel" role="dialog" aria-modal="true">
            <div class="settings-header">
                <h3>Keyboard Settings</h3>
                <button id="close-settings" class="close-settings" aria-label="Close settings">‚úï</button>
            </div>
            <div class="settings-section">
                <details class="settings-group" open>
                    <summary>Layout & Input</summary>
                    <div class="slider-control">
                        <label for="key-size-slider">Key Size</label>
                        <input type="range" id="key-size-slider" min="40" max="80" value="50">
                        <span id="key-size-value">50px</span>
                    </div>
                    <div class="slider-control">
                        <label for="key-gap-x-slider">Horizontal Key Spacing</label>
                        <input type="range" id="key-gap-x-slider" min="0" max="32" value="32">
                        <span id="key-gap-x-value">32px</span>
                    </div>
                    <div class="slider-control">
                        <label for="key-gap-y-slider">Vertical Key Spacing</label>
                        <input type="range" id="key-gap-y-slider" min="0" max="32" value="32">
                        <span id="key-gap-y-value">32px</span>
                    </div>
                    <div class="voice-control">
                        <button id="start-voice" class="voice-btn">üéôÔ∏è Start Dictation</button>
                        <button id="stop-voice" class="voice-btn" style="display:none;">‚èπÔ∏è Stop Dictation</button>
                        <span id="voice-status" class="voice-status">Dictation idle</span>
                    </div>
                </details>
            </div>
            <div class="settings-section">
                <details class="settings-group" open>
                    <summary>Appearance</summary>
                    <label for="theme-select">Theme</label>
                    <select id="theme-select">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                    </select>
                    <label for="accent-mode-select">Color Mode</label>
                    <select id="accent-mode-select">
                        <option value="gradient">Gradient</option>
                        <option value="solid">Solid</option>
                    </select>
                    <div class="color-pickers">
                        <div class="color-input-group gradient-only">
                            <label for="accent-start-input">Gradient Start</label>
                            <input type="color" id="accent-start-input">
                        </div>
                        <div class="color-input-group gradient-only">
                            <label for="accent-end-input">Gradient End</label>
                            <input type="color" id="accent-end-input">
                        </div>
                        <div class="color-input-group solid-only">
                            <label for="accent-solid-input">Solid Color</label>
                            <input type="color" id="accent-solid-input">
                        </div>
                    </div>
                    <button id="accent-reset-btn" class="primary-btn small">Reset Colors</button>
                </details>
            </div>
            <div class="settings-section">
                <details class="settings-group">
                    <summary>Tools & Testing</summary>
                    <label class="toggle-row" for="stats-toggle">
                        <span>Show Stats Panel</span>
                        <span class="switch">
                            <input type="checkbox" id="stats-toggle" checked>
                            <span class="slider"></span>
                        </span>
                    </label>
                    <p class="settings-hint">Run formal trials with target sentences and capture keystrokes, MSD, and adjusted WPM. Trial controls live alongside the Target/Typed summary box.</p>
                    <label for="trial-sentence-select">Target Sentence</label>
                    <select id="trial-sentence-select"></select>
                    <div class="trial-controls">
                        <button type="button" id="trial-random-btn" class="primary-btn small finger-target">Random Sentence</button>
                        <button type="button" id="trial-next-btn" class="primary-btn small finger-target">Next Sentence</button>
                        <button type="button" id="trial-history-btn" class="primary-btn small ghost finger-target">üìã View Saved Trials</button>
                        <button type="button" id="trial-export-btn" class="primary-btn small ghost finger-target">‚¨áÔ∏è Export CSV</button>
                    </div>
                    <div id="trial-history" class="trial-history hidden"></div>
                </details>
            </div>
        </div>
        
        <!-- Stats Dashboard -->
        <div class="stats-dashboard">
            <div class="trial-panel" id="trial-panel">
                <p class="trial-target"><strong>Target:</strong> <span id="trial-target-text">Select a sentence to begin.</span></p>
                <div class="trial-metrics">
                    <div>
                        <span class="metric-label">Swipes</span>
                        <span id="swipe-count">0</span>
                    </div>
                    <div>
                        <span class="metric-label">Elapsed</span>
                        <span id="trial-elapsed">00:00</span>
                    </div>
                    <div>
                        <span class="metric-label">Adjusted WPM</span>
                        <span id="trial-wpm">0</span>
                    </div>
                    <div>
                        <span class="metric-label">MSD</span>
                        <span id="trial-msd">0</span>
                    </div>
                    <div>
                        <span class="metric-label">Keystrokes Logged</span>
                        <span id="trial-keystrokes">0</span>
                    </div>
                </div>
                <div class="trial-inline-controls">
                    <button type="button" id="trial-start-btn" class="primary-btn small finger-target">‚ñ∂Ô∏è Start Trial</button>
                    <button type="button" id="trial-complete-btn" class="primary-btn small finger-target">‚úÖ Complete</button>
                    <button type="button" id="trial-cancel-btn" class="primary-btn small ghost finger-target">‚úñÔ∏è Cancel</button>
                </div>
                <div class="trial-inline-status" id="trial-status">Select a target sentence and press Start Trial.</div>
            </div>
        </div>
        
        <!-- Text input area -->
        <div class="input-section">
            <textarea id="typed" class="finger-target" placeholder="Tap keys or swipe across them to type..."></textarea>
        </div>

        <!-- Keyboard container -->
        <div class="keyboard-area">
            <div id="keyboard-container"></div>
            <div id="gesture-trail"></div>
        </div>
        
        <!-- Hand tracking controls -->
        <div class="eye-tracking-controls">
            <button id="start-hand-tracking" class="eye-btn">üëÜ Start Finger Tracking</button>
            <button id="stop-hand-tracking" class="eye-btn" style="display:none;">‚èπÔ∏è Stop Finger Tracking</button>
            <span id="hand-status" class="eye-status">Finger tracking inactive</span>
        </div>
    </div>
    <div class="settings-overlay" id="settings-overlay"></div>
    <div class="intro-overlay" id="intro-overlay" aria-hidden="true">
        <div class="intro-modal" role="dialog" aria-modal="true" aria-labelledby="intro-title">
            <h2 id="intro-title">How to use the keyboard</h2>
            <ul class="intro-list">
                <li><strong>Tap</strong> letters or drag across them to swipe words faster.</li>
                <li><strong>Hold</strong> any letter for 3 seconds to draw gesture trails.</li>
                <li><strong>Voice dictation</strong> lives inside ‚öôÔ∏è Settings when you need it.</li>
                <li><strong>Finger tracking</strong>: start the camera controls to select keys hands-free.</li>
            </ul>
            <label class="intro-checkbox">
                <input type="checkbox" id="intro-hide-checkbox"> Don‚Äôt show this again
            </label>
            <button id="intro-close-btn" class="primary-btn">Got it</button>
        </div>
    </div>
    
    <!-- Video for hand tracking (hidden) -->
    <video id="hand-video" style="display:none;"></video>
    
    <!-- Finger pointer -->
    <div id="finger-dot"></div>
    
    <script src="keyboard.js"></script>
</body>
</html>
